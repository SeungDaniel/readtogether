## 0. 전체 목표 한 줄 정리

> **“요한복음 읽기 로드맵을 기준으로,
>
> ① 단체방에는 ‘오늘의 본문’을 매일 자동으로 보내고,
>
> ② 개인 1:1에서는 각자 속도로 퀘스트처럼 진행·기록할 수 있는 텔레그램 봇”**

* 관리자는 **구글 시트**만 수정해서 플랜을 바꾸고,

  실제 발송은 **오라클 서버**에서 돌아가는 파이썬 봇이 맡는 구조.

---

## 1. 1단계(MVP) – “공동체 단톡방 데일리 본문 봇”

### [MVP-1] 구글 시트 기반 읽기 플랜 관리

* `plan_sheet` 예시 컬럼
  * `day` (1, 2, 3…)
  * `ref` (요 1:1-18)
  * `title` (빛으로 오신 말씀)
  * `summary` (3줄 이내 요약)
* 관리자는 **시트에서만** 범위/제목/요약/순서 수정 → 코드 수정 없이 반영.

### [MVP-2] 오라클 서버 + 텔레그램 봇 연동

* BotFather에서 토큰 발급, 서버에 환경변수 설정
* 특정 `GROUP_CHAT_ID`로 메시지 전송 가능 상태 만들기

### [MVP-3] 날짜 기반 “오늘의 일차” 계산

* `START_DATE`를 기준으로
  * 오늘 날짜 → `day_index` → `day = day_index + 1`
* 시트에서 `day`에 해당하는 한 행(`ref, title, summary`) 가져오기

### [MVP-4] “오늘의 본문 안내” 메시지 템플릿

* 형식 예:
  * `오늘 읽을 범위는 요 X:xx-xx (제목) 입니다.`
  * `이런 내용입니다: (summary)`
  * `읽고 퀴즈를 내거나, 인상깊은 구절을 공유하는 등 자유롭게 인증해주세요.`
* 한글/이모지 등 최소 UX 정리

### [MVP-5] cron으로 매일 특정 시간에 자동 발송

* 예: 매일 08:00 서버 시간 기준
* 실패 시 로그 남기기 (log 파일)

> 👉 여기까지만 되면:
>
> “공동체 단톡방에서 매일 요한복음 본문 안내 받기”라는 **핵심 경험**이 완성됨.

---

## 2. 1.5단계 – “방 모드 고도화(조금 편의 기능)”

> 여전히 “방 전체 모드”에만 집중하고, 개인 퀘스트 모드는 아직 안 만지는 단계.

### [G-1] 2세트 발송 설정 (짧은 구간은 두 개 보내기)

* 방법 A (간단): 코드에서 `DOUBLE_SET_DAYS = {1, 5, 12…}` 세트로 관리
* 방법 B (조금 더 데이터 드리븐):
  * `plan_sheet`에 `batch` 컬럼 추가 (1 or 2)
  * `batch=2`인 day에 한해서 `day, day+1` 같이 발송

### [G-2] 오늘 본문에 “공동체 DAY 번호” 표기

* 예:

  `**[공동체 DAY 10] 요 4:43-54 (왕의 신하 아들의 치유)**`
* 사람들에게 “지금 몇일차까진 왔구나” 감각 주기

### [G-3] 간단한 에러 메시지/알림 설계

* 시트에서 오늘 day를 못 찾았을 때 →
  * 방에는 안 보내되, 로그에 경고 남김
  * 나중엔 관리자 개인 채팅으로 “오늘 day=XX 행을 찾지 못했습니다” 전송 가능

> 👉 1.5단계까지 끝나면:
>
> “공동체 데일리 말씀 안내 시스템”이 꽤 안정적으로 돌아감.
>
> 이 상태에서 개인 퀘스트 모드를 붙이는 게 깔끔함.

---

## 3. 2단계 – “개인 퀘스트 모드(1:1 진도 관리)”

여기서부터가 네가 말한 **퀘스트 깨기 UX**의 핵심.

### [P-1] 개인 진도 저장소(progress_sheet) 설계

* `progress_sheet` 예시 컬럼:
  * `user_id` (또는 chat_id)
  * `username` (옵션)
  * `current_day` (다음에 읽을 일차)
  * `last_read_at` (마지막으로 읽은 날짜)
* 한 사람당 1행

### [P-2] `/start_john` – 개인 플랜 시작

* 동작:
  1. `user_id`로 progress_sheet 조회
  2. 없으면 `current_day = 1`로 새 행 생성
  3. 있으면 “이미 진행 중입니다, 현재 N일차…” 안내
* 응답 메시지:
  * 이 봇이 개인 모드에서 할 수 있는 명령 소개:
    * `/next` : 다음 퀘스트 받기
    * `/repeat` : 방금 퀘스트 다시 보기
    * `/status` : 내 진행 현황 보기

### [P-3] `/next` – 다음 퀘스트 받기

* 동작:

  1. progress_sheet에서 `current_day` 조회 (없으면 1로 가정)
  2. plan_sheet에서 해당 `day` 행 가져오기
  3. 그 본문을 텔레그램으로 전송
  4. **사용자 명령 기반 버전 (기본)** :

  * 곧바로 `current_day += 1`로 업데이트

    (나중에 인라인 버튼까지 넣는 버전은 2.5단계로)
* 메시지 형식:

  * `[개인 DAY N] ref (title)`
  * `summary`
  * “인상 깊은 구절 / 한줄 소감 남겨도 좋습니다. 다음 퀘스트는 다시 `/next`로 받을 수 있어요.”

### [P-4] `/status` – 내 진행 현황 확인

* 예시 응답:
  * `- 완료한 퀘스트: 4/66`
  * `- 다음 퀘스트: DAY 5 – 요 2:13-25 (성전 정화)`
  * (옵션) `- 마지막 읽은 날: 2025-11-28`
* 필요 데이터: plan_sheet에서 다음 day 1행 조회

### [P-5] `/repeat` – 직전 퀘스트 다시 보기

* 현재 `current_day` 기준으로 `current_day - 1`일차 본문 다시 보여주기
* `current_day == 1`일 때 예외처리 (아직 읽은 게 없으면 안내)

> 👉 2단계가 끝나면:
>
> * “공동체 단톡방”은 날짜 기준으로 흘러가고,
> * “개인 DM”은 각자 진도 기반으로 퀘스트를 깨는 구조 완성.

---

## 4. 2.5단계 – 개인 퀘스트 UX 강화(선택)

이건 “필수는 아니지만 있으면 재미와 정교함이 올라가는” 기능들.

### [PX-1] 인라인 버튼으로 “오늘 퀘스트 완료” 받기

* `/next`가 보낸 메시지 아래에 버튼:

  * `✅ 오늘 퀘스트 완료`
* 버튼을 눌렀을 때만 `current_day += 1`로 진도 올림

  → “읽었다/안 읽었다”를 더 명확하게 구분

### [PX-2] `/today_group` – 개인 DM에서 오늘 공동체 본문 받기

* 개인 DM에서:
  * `공동체 오늘 본문 (공동체 DAY N, ref, title, summary)` 전송
* 혼합 사용 가능:
  * 내 퀘스트는 DAY 3이지만,
  * 오늘은 공동체 DAY 10도 같이 읽고 싶을 때

### [PX-3] 오래 안 읽은 사람에게 부드러운 리마인드(DM)

* `last_read_at` 기준으로 N일 이상 안 읽은 사람에게:
  * “요한복음 퀘스트, 지금 N일째 쉬고 계십니다. 다시 시작해볼까요?”

    (cron으로 하루 한 번 돌려서 DM 발송)

---

## 5. 3단계 이후 – “통계/아카이브/멀티 플랜” (미래 확장용)

지금 당장은 아니고, 나중에 인터넷팀/청소년 캠프/인턴십이랑 엮을 때 쓸 수 있는 기능들.

### [F-1] 개인/공동체 통계

* plan_sheet + progress_sheet로:
  * “이번 주에 가장 많이 퀘스트 깬 사람 TOP 3”
  * “현재 전체 평균 진도”
  * “모든 사람이 완주한 날”

### [F-2] 여러 플랜 지원 (요한복음 말고 다른 계획)

* plan_sheet를 여러 개로:
  * `plan: john`, `plan: psalms`, `plan: romans` …
* 명령:
  * `/start_john`, `/start_psalms` 등
* progress_sheet에 `plan_name` 컬럼 추가:
  * 한 사람이 여러 플랜을 동시 진행 가능

### [F-3] 인증 내용 아카이브 (예: 구글 시트/노션으로)

* 개인이 보내는 “인상 깊은 구절/소감”을
  * 날짜, day, ref, text, user_id와 함께
  * 별도의 시트에 축적해서 **영적 아카이브 데이터**로 활용

---

## 6. 전체 기능 목록 정리 (우선순위 표시)

* **Must (최소 기능 / 1단계, 1.5단계)**
  * [MVP-1] plan_sheet에서 하루 본문 정보 관리
  * [MVP-2] 텔레그램 봇 + 오라클 서버 연동
  * [MVP-3] START_DATE 기준 날짜 → day 계산
  * [MVP-4] “오늘 본문” 메시지 템플릿
  * [MVP-5] cron으로 매일 자동 발송
  * [G-1] 2세트 발송 설정 (코드 or 시트 batch 컬럼)
  * [G-2] 공통 DAY 번호 표기
* **Should (개인 퀘스트 기본 / 2단계)**
  * [P-1] progress_sheet 설계
  * [P-2] `/start_john`
  * [P-3] `/next`
  * [P-4] `/status`
  * [P-5] `/repeat`
* **Could (고급 UX / 2.5단계 이후)**
  * [PX-1] 인라인 버튼 “오늘 퀘스트 완료”
  * [PX-2] `/today_group`
  * [PX-3] 장기 미접속자 리마인드 DM
  * [F-1] 통계/리더보드
  * [F-2] 여러 플랜(요한복음 외) 지원
  * [F-3] 인증 내용 아카이브화
